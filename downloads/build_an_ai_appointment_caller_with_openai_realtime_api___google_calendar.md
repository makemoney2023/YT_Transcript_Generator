# Build an AI Appointment Caller with OpenAI Realtime API & Google Calendar

## Metadata
- Duration: 00:53:46
- Author: Bart Slodyczka
- Views: 1,275

## Transcript

Hello Legends. So in this video, we're gonna be demonstrating an outbound caller with real time Api. That's gonna call your customer and it's gonna book them in, into your Google calendar. So at the back end of the system is the code is built on rep just like the previous videos. The automation that actually calls the customer that's triggered from meg dot com. So you can essentially have a Google sheet. That just iterate through a row, rows of customer, like, people that you wanna call, and it'll trigger that with meg dot com then we'll call the actual customer, and then the automation that checks if the booking slot is available in Google calendar, and then actually books the customer in. That's also on meg dot com. So this is gonna be a super easy deployment, I'm wanna demonstrate in the second the actual live phone call, and I'm gonna basically reject a time. So you can see that the suggested time that I get. I wanna be able to re book that. But, yeah, if you watch some of the previous videos, you'll see that we made an inbound agent. We made an inbound agent that has function calling. So, yeah. If you kind of go through the previous videos, you'll be able to really build out a super unique inbound and outbound agent using the real time Api. It'll be able to do function calling, it's gonna, be able to do Faq answering, It's gonna be able to do booking people into Google calendar as well. And, yeah, if for your business and you want this built out for yourself, if you want the custom code, like, all that infrastructure, specifically for yourself, which is a pretty common thing that people are asking for now as well. You can reach out to me my email in the description of this video, and I can help you build something out. But let me demonstrate this, and Wanna gonna get right into the build. So I'm gonna go to make the comment, it's gonna be off screen, and you can't see this. But when I demonstrate later on when we're on the actual, in a tutorial. I'm gonna show exactly how everything looks, You'll be able to see the Google calendar as well as I'm, like, booking it in. You can see it coming live as well. So it's been pretty cool. Let me just trigger this. Hi, Bart. This is sophie from Bart automotive. I'm calling because you submitted an inquiry about a turbo upgrade for your car. We have an opening this Friday, November twenty nine at nine Am. Would that time work for you? Or would you prefer to schedule another time? I'm busy at nine Am, can we do eleven Am? Of course bart, let me check the availability for eleven Am on Friday. When one moment, please. Unfortunately, the booking was unsuccessful. Here's the update. Sorry. Friday, twenty ninth November at eleven Am isn't available, but we can be ten Am instead. Does this work for you? Yeah. Okay. Let's do ten Am. Your turbo upgrade appointment has been successfully booked for Friday, November twenty nine at ten Zero am. You will receive an Sms reminder closer to the date. If you have any questions, feel free to reach out. Thanks. And we look forward to seeing you then. Alright, See. Thank you. Alright. And that was a demo. As you saw, I, had a suggested time. I denied that time. I then, was proposed another time that I could choose. And then, yeah, ultimately, we we booked in at a different time. So it's dynamic. We can try and book in, we can get a failed result, and we can get an alternative time for us as well. So let's get into the build. I'm gonna show you how to get everything set up, how to deploy it into Twilio, how to deploy it on rep. That kind of stuff is gonna be more, high level for this video. The previous videos, you could really go into those, and I'll... I kind of dive into the specifics of deploying it on Rep and and Twilio and how to make the make dot com integration. So Yeah. I'm gonna kinda speed through here really focusing on the key changes to this outbound code in rep and also the two meg dot com scenarios and how you can use them and kind of edit them to your needs as well. Okay. Let's get into this. Alright. So let's start going through the rep up Now if you wanna follow along, you can go to the description of this video, I'm gonna have a gum road link that's gonna have this replica code as well as both make dot com scenarios available for you to download for free. But if you are... If it's within your ability, then you can, you know, you can donate as well. I'd appreciate that. It takes me quite some time to to build these things out, especially things like the... Whereas, like, this automation here for a Google calendar. Lots of people were asking for it, so I thought right thing to do. But, yeah, anyway, it's all like, you could just take it for free. And subscribe to my channel, like, like the video, share it, comment on it or That'll help boost engagement. So if you can just do, like, one of those things would be pretty cool. Or if you don't wanna do any of that and you're just on the on the Gun road link. Just, like, leave a review, something like that, like, take a little, give a little, Our reckon that's pretty cool. But anyway, let's get into this, into this code. So like you just saw, the code right now, it's... This is specifically for outbound calling. So if you watch the previous videos, this code is different because there is a different setups for outbound calls versus for inbound calls. So the way that this flow is gonna work is we have this... We've got this module over here which we trigger, and we pass through two different variables. One is a first message that will typically contain all of the like, personalized information for that specific caller, So over here, like, in the call, I just demonstrated, You could see the... Of the Sophie, said, hey, Bar, you're calling for the Turbo upgrade, and here's our next available slot. I'm also passing through the customer's phone number here as well. So there's two variables. One is first message and one is number. So these very millions have to stay exactly the same because they're captured in the rep code exactly like this. But the idea is that, if I go back to rep quickly, we have a prompt file, which this is the actual prompt for the overall assistant So in here, I've got the, like, guidelines, the personality, what the purpose of this call is the context behind, like, like, you know, to give as much information as possible to this agent. I've got this. Steps listed out, so you could use this as a starter template if you like. And I've got some Faqs as well. Just to kinda reduce the latency, not need to do Faqs, but in some of my other videos, I already show you how you can get Faqs from, like, attached Pdfs and stuff like that. So this is, I think from video part three. And this web has, like, a bunch of different, like, actions it can do. I'm not gonna go to deeply into it, but one of the actions is it can trigger a, like an open Ai assistant, like a custom Gp that you might have loaded up with all of your company information. So if you wanna do Fa faq management outside of just your local assistant prompt, then you can do that using this make the com scenario from part three video. But at a high level, this prompt is, as you can see, it's like a general prompt. But what we really wanna do is passing some information into the agent that says, hey, This is their unique customer, and here is their unique information. So when you're calling and speaking to them, like, let's personalize this interaction. And kinda like when you're speaking with chat Gp to initiate a conversation, you have to message first, and then the chat Gp will respond to you. So what we're doing is that first message that, like, if we were in chat Gp. That first message we're sending, is just a kinda like a secondary prompt. And if I open up that part there it is. And basically, what we're saying here is, hey, you're about to start a call. You're calling the customer. Customer's name is Bart. This is what you're calling about, even meant to book an appointment with them. This is the next available slot, you know, blah blah blah, and then finally here, we're saying you're about to start the conversation now. That's why when we get the phone call, we're spoken to first, and that's why the like, the agent says, Hey Bar. You're calling about this service our next available time is this time. So this is yet. This is how we personalize the actual interaction. What you would do is... I haven't plugged it into Google Sheet. I just ran this before by right clicking and saying run this module. But what you would do, you get your Google sheet row, you would sync it up. You'd pull out all the variables that you need from Google sheet. And then you would, like, for example, remove this, and then you would select your variables. And I've got none here. I haven't I don't have a... Of this plugged in for the demo, but you would just choose, like, for here, you would highlight and put the variable for customer name. Here, you would put in, you know, for me, it's a turbo upgrade. Like, what's the service about. But maybe if you have a bunch of leads for your service based business, and people complete a form. They might have a reason for the form or of service they wanna buy. So then, again, you would just from Google sheets, just fill out all this information. Here, you might have another automation that just already pre checks your calendar for the next available time. And then, yet, the phone number as well, you would just pull in from Google sheets. So Google sheet would have customer name, phone number, you know, next available slot, and, you know, what whatever else you want. So you would pull it in from Google Sheets, and that's how you can get it automated to just do hundreds of calls, thousands of calls a day whatever. So now that we have the understanding of how the call is triggered. Let's get back into the code. And at a high level, you don't need to change anything in this... I think I'd be maybe like, one or two things you need to change. But overall, you don't need to change too much, but the environment variable you do, and we'll look at that in a second. The first thing I wanna bring your attention to is this section here we have transcript web hook and booking web hook. So all I've done is, for transcript web hook. This is the after the conversation finished and the phone call is like we've hung up the phone call. We're taking the time entire transcript of whatever the agent said, whatever the user said, and we're sending it across to make dot com. If you watched the part three video you would know that. We we use this kind of system to manage the post call transcript. So all I'm doing is just defining this web Url, and to activate it in our system. We just place the Url over here. So you just literally copy copy it from that module and paste it here. Now booking web, this is the web hook that points across to our, this scenario here. So I'm literally just taking this Web Url. I'm gonna take it. Let me get back into the diagram mode. So I'm gonna take this web, just copy the address the clipboard, and then paste it into here. One thing that you will need to do when you're first rolling this out into your mate dot com is you probably click this. And you'll hit red predetermined data structure if you really have an existing web. Or if it's a brand new web it typically just says, like, like, determined data structure. So for that, you would just place a call with your real time Api, when it gets to the booking function, it'll just send some data across to here. And that data format just so you know, let me just find that booking function. So I'll explain all this in a second. I'm trying to find this specifically. It's a goodbye message. Nope. We want. Where am I looking? Where am I looking? Maybe to the very bottom for our main function No poor is our payload. Okay. So we have data one and data tools. So in this case. Yeah. So let me just find the actual appropriate one. It's just two... We're sending two variables in. Okay. There we go. So this is the actual web for the function for book of service. And we're sending the variable which is number and the variable which is message. So the message is just the booking time, the booking time that we're trying to, organize with the customer, and that's what we use for Google calendar. And then the caller number is the user's phone number. So and again, I'm gonna come back to this later. I kinda I wanna go through bit by bit, and we're just speaking about the web Urls, but the phone number is what we pass through into this booking Google calendar module where we create an event, and the phone number is gonna appear if I go to my calendar, It'll appear here, and it will say four, and then we'll have the phone number listed right here. Now you could make another, addition to this, where is it? You can you couldn't, kind of change something here where you take the phone number, you might wanna back through your Google sheets or through your Crm, you would take the customer's name and whatever else you want. And then you could just basically replace it into this module, that over here when you have a new booking, you're not using the phone number or maybe using the name and the phone number or, you know, maybe you can even generate a Google Meets link And what whatever you really need to do over here. But let's go back to where we were before. So we have the two web. Now if you wanted to do more function calling here, then, again, you can just take this code, and I'm gonna show you, you can just put it into chat And say, I wanna make another function call that during the call, you know, does x y it. And you would just use... A different web Urls for that, or you can build an entire system that you just use, like, one web Url, and then you, again, from part three video, you just have all your flows in one. Really it depends on what you think is can be easier for you to manage. I think something like this is pretty good. It's pretty convenient, But, yeah, Up to you guys. So that's what you would do here. This is where you list all the assistant actions that you would do through meg dot com. And I'm not gonna go through all the little bits and pieces for the code, but at a high level, what we're doing is... So when we when we set up a call with Twilio, we're actually work creating a media stream connection between Twilio and this code that we have. And that media stream is made for real time communication, and then we're actually using a websocket to create the connection between our code here and then open Ai. And that's why the latency is super super quick. One thing you would have noticed is when we were doing the booking functionality. When I'm like, no. That time doesn't work for me, I wanna do a different time, the reason that there was, like, three seconds between like, that that function call took three seconds. Is because we have these chat Gp modules. So what you could do, and I'm using this specifically because it's easier for me to trans transfer times between, like, make dot com will just use Ut time, But I'm in Australia. So I need a I need to use Australian timing. So when I'm looking into Google Calendar, I to convert au time into Ut. And that conversion, I just use chat Gp four. But because of that, it takes, like, one or two seconds to complete that Api call for chat Gp. But if you just had, like, maybe different tool calling or if does was like a different module, you could work for yourself, Like, that's why this is a V one, maybe the V two could just use no chat Modules, you would just use all logic. And if you did that, then that that call when it's, like, hey, can you do nine Am and I'm like, no can we do ten and it checks instead of taking three seconds, it would take... You like, less than a second. It'll be instant. So that's why there was that slight delay because we have all these, chat Gp steps. It's just me being lazy for an Mvp in building it out, but it's possible to make it faster. At the same time, another comment I wanna make is when you're doing, like, anything with chat Gp steps, Make dot com is instant, it's like a regular Api call. But as soon as you involve, chat Gp or any kind of Ll processing, It does take a little bit longer to process. And since in make dot com we're not using any streaming Api. Streaming Api would be as it's happening. Concurrently, we're we're receiving the response and we're speaking it back out to the user. And in another video that I made about building out your own Diy Ai caller completely, you know, using, eleven labs Deepgram open Ai, we use a lot of streaming Api calls. So a regular Api call you have to wait for the Api response to be fully generated. And then you could go to the next step, and that's what we're doing over here. We're not using any streaming at all in mate dot com. Make sure not sure if it's possible. But since we have to wait for the response to be generated, just like when you're met messaging chat Gp, sometimes like, you write something and will start writing straight away, But by the time, the entire response is finished, it's like three or four seconds. So streaming would concurrently send the message, but a regular Api call would wait for the three seconds before it displays the entire message. But let's go back into here. So... Yeah. Okay. What we're doing is Twilio has to create a media stream connection between Twilio and then this replica code. And then our replica code to also facilitate that real time conversation, which is why open Ai has. Freaking amazing, like, latency. It sets up a websocket, and then we have pretty much new real time back and forth communication. So in the inbound caller to actually initiate the phone call, it was a lot simpler. There was pretty much just like one step, where we send in a phone call, and then we're able to immediately tight, like, connect that phone call to a live line, so we can have a conversation. But for outbound calls, what we're doing in, make dot com, we're basically triggering this event, which is going to point towards this web over here forward slash outgoing call. So if I go back to here and I click this open, We have forward slash outgoing call. And this Url is just the Url rep scenario. So I'm gonna deploy this later on to make it live, and I'm gonna show you how to change this, so it's always active for you. Once you deployed it, But this this outgoing call, this web hook. It targets this function over here. And this function is just part of the sequence to actually start the phone call. And then after we target this, we go to this outgoing call t, and this is how we, then initiate that media stream connection between, Twilio and our rep code. So, yeah, again, meg dot com first lens into here. And then we're gonna go out of here into here. And then when we have the, like, configuration ready, we go from here into media stream. So there's an extra step here for outgoing calls, which is a little bit different again to the incoming call, like when we're like, an inbound agent. But it's no big deal. You don't need to change anything here. Basically, over here, we're actually taking the message from, the first message and the phone number that we sent through Meg dot com, and we're passing it through as parameters, for our media stream. And then in the media stream, we're taking that phone number, and then we're also taking the, that first message. And if I scroll through here, we're creating the websocket, we're setting up our, like, system configuration here, So there's actually two tools that we have. One is for ending the call and one's for booking the service. So just quickly, the end call, this is still like an Mvp, but the purpose here, and I'll explain the steps later on, but the purpose here is for the agent to recognize autonomously that the call is coming to an end to basically, like, hang up the phone. So it should hang up the phone when you get this. I think maybe I've made some changes, since I made this code. So it might not fully work, but it should be very close to working, so you might just need to put into chat Gp and say help me out. And I'm gonna explain exactly how it works. So if it's not working for you, it should be easy to, like, go chat Gp go to quote and ask it to help you out. But the key function that we wanna look at is this book car service for the customer, and the main parameter that we're sending through is just the booking time. And that booking time you might need to play around it a little bit for yourself depending on what times zone you're in, but we're calling that function over here, so booking the service, you off the customer the supply time the customer accepts. Book it using the book call service, sorry the book underscore service function, which is this. And we're requesting to send the details in the Australian time zone in this format. Twenty ninth of November at at ten Am. Now, it really depends on how accurately the this function call would work like how accurate the system is. For me, sometimes, it might not send it twenty ninth in November at ten Am It might send it kind of, like, maybe with the year, maybe with not the year. So you might just need to do a cup... Like, a little bit of debugging for yourself here, but typically, it works for me fine, but because it's an L, you know, again, this is all a v one code. You might need to do some troubleshooting yourself. The second point is if the customer doesn't accept the time, and, asks for an alternative alternative time, then call the same function and then generate some alternative time. So once again, you can get the prompt and you can sharpen it up for yourself, but the two things that it does And if I go back into here is, we're receiving the event from the customers of the proposed time. We're processing it. We're checking it in the calendar. We're generating a response to see in the calendar. What's the, currently, already booked out schedule. And then we're using this chat Module to compare the proposed time from the customer, either the one that we suggested to them, or the one that the customer countered with, and we compare, using chat Gp to the busy schedule, which is all the already taken slots and we see if it's available or not. If it's available, then we'll book it in using this Google calendar module. But if it's not available, we're gonna take this route, and then we do a little bit more processing to determine... Okay. Here's all the times that we're busy, let's recommend another time that we can actually offer to the customer on that same day. So you have a lot of capability here to offer it, like, you can put a lot of requirements here and say we only work from eight Am to four Pm, so that proposed time must be within this time. If it's not then book it in for the next business day. We have a tool over here which gets the current time and date, which we pass into these chat Calls. So it's always... It always knows what year it's in. I think right now kinda defaults to twenty twenty three. But going back into the code to kinda keep pushing through. That's the booking function here. Now if I keep scrolling down, here is a function that we're we're sending the first message into the, assistant. And that first message once again is from this outbound caller, which contains all of our variables inserted information, like customer name, appointment time, what their service is, and then we have the phone number here as well, but we're not passing that in as the first message. The fur the phone number is just to make the outbound call. So that's what we're doing over here. We're setting up that function that's gonna feed in that first message. And now, we also have interruptions. So speech interruptions is this function here. Someone in one of the previous videos, maybe video two or video three commented this beautiful code. That handles interruption. So as the agent is talking, you can just talk over the agent and then continue the conversation, which is pretty natural, and it works very very well. And here we have the function calling. So I'll explain the end call function first, and then I'll go across to the the next function, which is booking the service. But at a high level, when you make a function call, and you have part of the function call and Api request, and then you have a response that, you typically want the model to respond back to your customer. So for example, for our book service, we would have the function call to make dot com first, it checks the availability. It gets the response, then the assistant uses that response to generate a response to the, actual cost customer. So that sequence is Api call first or, you know, function execution first, and then the, response is generated. So initially, when I was building this out, I thought, alright. I'll just send an event that ends the call because you can, like, you can just cut the media stream, you can cut the websocket You can just, like, terminate the call manually. But what we... What I found was, I would make the actual call. It would cut the phone conversation, and there was not enough time for the agent to actually say goodbye. Because once again, it always just does the function first, and then the actual response after. So what we need to do is We call the function, and the first function is to just say a goodbye message, Something like, alright. Thanks for the phone call. It was fantastic speaking with you, blah blah blah. Step two is to generate a message as if it's coming from the customer, And then we just silently insert it into the conversation so the customer doesn't hear this. The agent doesn't hear this, or the agent gets it it's part of the thread. And then step three is to now call the hang up function. So we call the hang up function, and then we close the call. So the sequence would be, let's say, I'm the Ai and you're the customer. I would recognize Alright. It's time to end the phone call. So I would say, hey, Bar, It was amazing speaking with you. It's awesome that we booked you in. I'll chat to you next time. Then the customer sends a silent message kind of a k a. It just skips a turn. And then I have my next turn as the Ai, and now I just call the function to end the phone call. So that's how this works. Simulate user import. Okay. I I might have yeah Okay. So that... I started at one one too many. So create the system message first, then we're sending the to generate the audio message to the actual customers, so they're gonna hear a goodbye. Thank you for the call, then we simulate the customer's response back into the Ai thread, and then we actually get the Ai to end the phone call. Now there's a couple of, variables over here, and these are in seconds. So this is six seconds and three seconds. I'm sure there's a different way to do this, but what I've done over here is when you say that final message, since it's dynamic, Yeah. Since it's dynamic, the length of their message could be three seconds could be six seconds could be ten seconds. Depending on what your context of conversation is. So as we are over here when the Ar ping that message, it technically sends the message. And then since we're sending the user response so quickly, this is still being spoken while the user response is going back into the thread. And then we're already here at the end call function. So sometimes we're still lagging behind speaking to the customer what the actual goodbye responses is. But if if they're goodbye responses like ten seconds. Hey, thank you for the phone call. It was amazing. I have booked you in, I look forward to speaking with you. And this would just... Wait six seconds and just hang up. So here, you would just need to either set a predefined message. So you're not, like, set a predefined message. That's not dynamic, It's just like, okay. Goodbye. I'm hanging up. But I think dynamic works better. And then if your phone calls hang up too quickly, you would just extend this timing out to maybe nine seconds and, you know, one... You know, the the... This is for this phone call six seconds. This one is for one of the other Api calls, but you can play around with this and you'd figure it out. That's how the end call function works. And it should actually end the phone call. It should actually, like, beep out for the customer. But if it doesn't, because I've done a couple of code changes since that time, you might just need to use Ai to help you out. Just Now book books are... Actually, let me just tell you how the prompt works here. You could read it anyway, but closing. So ending the call. When the conversation is done, say goodbye and call the end call function. You can change this up to say, alright. You know, maybe you could pull a little time or somewhere into the code that, picks up that it's been five minutes. You wanna call every call after five minutes, or you might say, cool after we've done x y and zed steps then call this function. So you can really call it whenever you want. I, I made mine very simple, but you could even say something like, once the conversation is slowing down so much, and you on... And, you know, you basically said that there's nothing else to speak about, then call this function. So it doesn't just prematurely call it. But I've had no problem so far. Okay. So book service... Book service, we're basically, yeah, We're calling this function, and all we're doing is using mate dot com. To send a payload. Yeah. We're using an Api call to send a payload to make dot com. And this is the payload here. Oops. This is the payload here. So the phone number we're sending in because Well, you probably wanna send the phone number every single time you make an Api call because it's the unique identifier for this specific customer. You can get the phone number and then you can find the customer in Hubspot. You can get the phone number, then you can find the customer on Google sheets. So you wanna send the name ideally, you just sent the phone number, and then using the phone number you plug into different tools to get whatever information you want. And then the message is just the, booking time for like, for the for the one case booking the service for the car. That's all we're doing here. And then for our response, we... Yeah. Okay. So the response message is what we're, sending back. From the Google calendar module. So status successful. If we've booked it in as as well as the booking message. So it's gonna say something like, yet we've booked it in. And here the response back to, Rep is gonna be status unsuccessful. And then the booking message is the re book, re book message that we're getting from this module over here. So I'm gonna demonstrate this in a second. But at a high level, that's what we're doing over here. We're basically placing that Api call. And we're we're parsing the response to see if it was successful or not. And if it was not successful, then we're gonna read back that response to the customer, and that's why we had that, Like over here. So if it was unsuccessful, we read it back to the customer saying the booking was successful, we booked you in for x y at time. Or if it's unsuccessful, unfortunately, the booking was unsuccessful, here is the update. That's why our agent at the start of the call, so here's the update, and then we had a message. So really, you could probably just do unfortunately, and then cut all this stuff out, and then you just read this response as it is. And that response, you would just you would edit over here. So you might say generate a response it's gonna be spoken directly to the customer. Make it say x y and z and then fill in the blanks. So you can do whatever you want. So that's how you can edit the actual function calling and then be successful or unsuccessful. And if I put that a little bit more we have some Yeah. Basically, this is all the settings for logging user and agent transcripts. Once the connection is closed, this is how we send the transcript across to make dot com. I'm not gonna go through that too much. And then we have our main function, yeah So this is the primary function that it's like a template function for interacting with meg dot com. So this is the actual function name sent to Web, and, both those functions, which is send transcript at the end of the call. And then the book book of service, both of those rely on this function to actually be the infrastructure for making the Api call. So this makes it a lot easier because when you copy and paste this code, you can just say, hey. Use the center function, And then all you need to do is minimal coding in your, function calling here. Where is it? You would do minimal coding. Like, you would say, you put another note else if you would put function name and you might have some other function name that you wanna call. Again, across to make dot com. And here is the, you know, this how we call that function sent to Web. And we're passing in our dynamic variables, including our dynamic Url. And once again, this is where the Urls are kept. Okay. So went through this code, everything is good E file. Okay. So we need to put our, open Api key into this place here. So I think you guys now how to get yours already. And the next thing is you have Twilio account Si, which you get from your Twilio homepage, and then your Twilio Auth token, which is gonna be directly below the Si. You got my previous... Actually, maybe I don't mention this, but I'll I'll go through this quickly. And then Twilio number. So this is this is the Twilio number, which is the phone call you're gonna be calling from. So let's just go across the Twilio quickly. So let me go back into account dashboard. Account Si and auth token we have over here in our main dashboard, account Si, and then auth tokens. You would just copy and copy. Now the final one, which is Twilio number, It's not the number from your dashboards, not this number. Actually, you would just go to wherever your phone number is kept. The one that you want to use to place the calls. In my case, I'm gonna go to Australia. Phone number manage active numbers. And I'm using this phone number here, so I'm gonna open it up. Okay. And you would just... Yeah. You would copy that. And then you would paste it into here. So that would mean that your entire configuration is set. Again, the only thing is for index. You would just need to set your, mate dot com web hooks over here. And now, let's actually deploy this. So I was using for testing, I was actually just using this run button. And when you're running, you could copy this development, Sorry this... Yeah, this development Url, and you could paste it into your mate dot com over here, and you would paste it in. Oops. What have I done? I've double paste it. Anyway, you get... You get the point. I'm trying to double paste it here. You paste it into here, you'd have the forward slash outgoing call. And for dell development, you can just use this. But if you do wanna deploy this, set up your deployment I'm gonna go approve. I just use a default. Use default until it becomes, like, it's not enough, and then you can figure out how to upgrade the rest it, but I've never had a problem with this so far. Like okay. So it's gonna take a couple of minutes. Let me start going through this at a high level. So once again, it is an Mvp. It's a v one. It might not be one hundred percent perfect, but the more I build this out I'll share with you guys. I just had a lot of comments from people saying Google Calendar Google calendar. And the cool thing here is, like, I know there's a cal dot com integration. And I think that's fantastic. If you're using something like retail, and I wanna make a video on that soon. But I've got a customer, for example, that when they book in, they wanna check how many bookings are in a specific day. And they wanna generate bookings at a specific time based on the person's post code. So having an automation like this for mate dot com, I can now really easily, you know, pass through the customer's post code, their address, I could then figure out are they do they line batch a, do they line batch b, I might have a router for the two batches to, like, book people only for the mornings for batch a and for the evenings for batch b. And then I'm able to do checks as well and say, okay. If they are in the morning slot, how many slots are available if there's none cool let's booking in for the next available time. So doing that is actually super... It's much easier in make dot com because you have the full control. But if you got a very basic booking then your cal dot com integration and retail would be fantastic and I don't know if there's a cal dot com integration here that might be. But, yeah, obviously, having the flow just means you can have total control. So what happens is we're receiving the web hook straight from, yeah, straight from rep, and it contains the phone number and the available time. Within then setting the current time to now. And send the current time to now, basically establishes for this sequence, hey, we're basically we're in twenty twenty four. And today's date is twentieth eighth of November. So we're not gonna, like, book something for twenty twenty three. We're not gonna book something for last year. Also a current date and time. Lets the chat Gb modules know exactly what. Current time... Like, they'll be able to Sorry. Convert Ut to Ae d t because they know exactly what date is, and I know when daylight savings is on and when it's not on. So passing through the actual, variable of current date and time, he absolutely fantastic. And you guys gonna have access to. I'm not really gonna go into all the details here, but this first one is what have we got here. You receive a date from the customer. You must output json object in the form of, state, start date. Yep. And then end date, and then you have an example here. So I'm just pretty much putting a start and end date. And so based on this is gonna be, like, a dynamic version of a available time that I'm sending through, chat Gb is then gonna take that dynamic version, and it's gonna convert it into a structured format that we can then use in here. We're parsing... Well sorry. We're parsing the response from chat Gp. It's gonna be a Json object. It's gonna have a start key and an end key. So we're gonna pass both those keys out to into two different variables, and we're gonna pass them into Google calendar into start and end, and then we're able to return all of the already, like, busy event. So this is... This module is get free busy information, and it's basically gonna return all the, like, busy slots for that day. And then, yeah, once again, we just pass out the information that we need. This Json module is gonna take all the busy events So, like, in one calendar day, For example, if I go here, you can see busy event, busy event, busy event, start and end time, start and end time, start and end time. It's gonna take all these busy events from this date range, which is twenty ninth of November. And it's gonna return them to us, where is this? This is gonna return them to us as an array of objects, and this is gonna return... It's gonna take this array of objects and convert it into a string. So instead of having an undefined amount of, time slots, we just have one variable that contains all the time slots. And then we pass it into this chat Step, and we say, hey. Remember that proposed time that we initially sent from this web, We're gonna feed it into here, which is proposed time, and I'm just establishing, hey, it's in Melbourne Au time zone. And then the busy times I'm passing from here, which is just the string that contains all the busy times that were from here. So in our example, it would have three sets of busy times. Whoops. And then the prompt is basically saying, or whatever criteria you want. If the proposed time doesn't clash with the busy times, output accept. If the proposed time does clash output deny, and note... And here's a... Here's something that the Ai was doing incorrectly before It was basically, if I had a proposed time that starts at ten Am, but our previous meeting ends at ten Am, then it would say, oh, there's... It's it's like the start and end time overlap, so let's didn't like, do not approve it. But I put some basic constructions that basically say, hey. Like, it took... It's okay. If it's crossover over time, We can accept that. But again, you just need to play with these prompts a little bit, they might not be the sharpest and work all the time, but the main thing here is we're looking for the accept and deny output. Now, Another point you might be asking is, well, why don't we go on advanced settings, I couldn't we save a step and go response format Json object. You could. But when we make this Api call, the chat Module actually shows the step one, step two step three thinking. It thinks through the actual response. And what you want is you want that thinking because it's more accurate in saying, oh, this is the Au time zone that's converted to Ut. Here's the Ut time, let's convert it, and now let's see if it's available or not. So you you... It's fine for us to have that thinking. It's fine for us to have that thinking done here because these filters all looking for is that the result from this chat Step contains the word accept or this filter, it contains the word denied. We don't care about all the other noise. We do care that it's there to make this more accurate, but we just really care about which which path do we take? Do we accept that? Because it's free, what we deny it's taken. So if we accept, it's free? Sorry. So Yep. Convert the following Melbourne au time into Ut output and adjacent object, and we put the proposed date and the current date as well. Now the current date here is important because... Chat Gb default date. I think currently is the twenty twenty three or it was in some of my testing. So I put the current date so it knows. Okay. It's twenty twenty four. Let's not get it wrong. And then we output in Json object. We passed the Json object, And then we insert that variable into here as a start date. And the title of the actual event is new booking for, and I put the phone number that we get from this web hook. That's what we have over here. And then I I also have duration is just one hour. So you can set the start and end date manually and chat Gp step, or you can set the duration yourself here, whichever works for you. And then we respond back with the, with the response. So basically saying, yep, the booking time, which is here. This message is from here. Saying it was successful. We sent back the exact same booking time saying, yep, thumbs up. And if it's not successful, whoops, it's not successful, we take this route over here, and Yeah. Pretty much similar input... As before, so proposed time by the client is this web proposed time. Here are the busy times, by the way, they're in Ut, not Melbourne. This is in mo... But you have to be very clear here. And then I got that overlap message that I had over here if it overlaps ends at ten starts at ten, totally fine. And then, yeah, once again, I just have this this check. So this step, initially, I had as, response format json object. But I found that again, missed the critical thinking elements step by step. So that's why I have two chat Steps here. One is for this critical thinking elements, and this is this is the actual response that we're creating that's sent back to rep that has the proposed revised time. And you'll see over here the prompt is gonna say, yep, You receive a time. We're not able to actually make it. Here's the proposed time. Here's the revised time revised time from here. So like, this is the busy route. Sorry. We can't make it. Here's an alternative time. Now create the message that has that alternative time, and output your format in Json object, then we pass the Json object that contains the alternative booking time, and we send it back in this web. And that's why in this code over here, if I scroll down. When we're calling this function, where is it booking time? Unfortunately, the booking time was unsuccessful. Here is the update. And that's that booking message that says, yep. Your time of x y was unavailable, can you do a or b instead? And that then the customer would say, oh, yeah. Cool. A sounds good. And then for, the Ai is gonna basically see, okay. We need to... You know, we need to call this function again for re booking. That's why this is freaking amazing. It's it's so so cool. Okay. So we finished deploying now, I'm gonna copy this Url. Let's go control c. So over in Twilio, I'm going to, backspace this, paste in my Url. And when you paste it in, make sure there's only just one forward slash after the Url that you got from rip, and you have outgoing call over here. So I'm gonna save the configuration. Actually, hang on. Sorry. This set might not be needed. If this call is book no, if the number is called. Okay. This Twilio step is I can't remember guys. I'm so sorry. I've been doing too many too many callers that I... I forgot what the sequence is here for... I don't Don't think we need this. Because we're gonna be calling this number, and it's gonna direct us to that actual rep. So, no. Don't... We don't need this, but it might actually work anyway. I can't remember. Do it anyway, you can just try it out for yourself if it doesn't work, then put the Url. Otherwise you don't need to put it here. But this setting is only if we call this number. And we're not actually calling this number. Outgoing cool outgoing cool. Anyway, you guys will figure it out. Let's get that Url one more time, control c, and we also need to plug it into here. So this one must be done because this is what we're using to initiate the outbound phone call. We're calling our actual rep function saying, hey, let's make this outbound phone call, so we need this. And once again, it has to have one forward slash here. Okay. So we have this. We're gonna save this totally fine. And now we don't need to run this anymore. And Google Calendar, I'm going to run this once. And what we have here, we have nine to ten, we have two to three. So I'm gonna propose a time for eleven Am, and we're gonna get denied. And then if I'm fast enough, I'm gonna propose a time for three Pm. So eleven Am to get denied, and then three Pm to actually get approved. Okay. So to trigger this outbound caller. So we're gonna get offered nine Am, we're gonna say no. Then we're gonna get offer... Then I'm gonna offer eleven Am. So let me just trigger this open by phone. Run this module only. Hi, Bart. This is Sophie from Bart automotive. I noticed you're looking for a Turbo upgrade and I'm calling to book you in. Our next available slot is on Friday twenty ninth November at nine am. Does this time work for you? Or would you prefer a different time? How about eleven Am? All right. Let me check our schedule for an eleven am slot on the twenty ninth of November? One moment, please. Unfortunately, the booking was unsuccessful. Here's the update. Sorry, twenty ninth November at eleven am isn't available. But we can do three Pm instead. Does this work for you? Yep. Friday twenty ninth at three Pm works. Let's book it in. Great. Your Turbo upgrade is now booked for Friday twenty November at three pm. You'll receive an Sms reminder closer to the date. Is there anything else I can help you with. No. That's it. Thank you. Thank you very much. Alright. So what happened here? And, okay. Maybe it didn't have enough tokens. Two zero four eight. Wait. Why would an output like this, though? Okay. So something happened here, that chat Gb completion step didn't fully work. So I think here... Yeah. I don't know. We might just need to see if it was a tote, but I'm not gonna take up too much of you guys time, but you would see here, it would take the tokens, and then it would, take the accept route. So because our response was prematurely cut off here from the result for some reason, again, I would just probably need to check the actual prompt to see why not working, and then it will take this route. So let me see if I quickly do that now. Alright? So let's try it one more time. Literally, all I did was just remove the token limit, and it works. So I don't know if that was just that specific time the module cut out by itself if that was a chat Gp Api error or what it was, but I don't think we reached two thousand tokens of that short response, but I removed it anyway. So that could... Yeah I I don't Don't know what's happening there. I'm gonna call up again. I'm gonna book in for three Pm, and I'm just gonna book it in directly now, so we can see that the other side of the flow works. So let me trigger this outbound call. But Hi, Bart. This is Sophie from Bart Automotive. Oh, hello. Hello. Hey. Can we... Yeah, can we book it in for Friday twenty ninth November at three Pm. Sure, Bart. Let me book you in for Friday, the twenty ninth of November at three p. Just a moment. The booking was successful twenty twenty four eleven twenty nine fifteen hundred Ut. Thank you Thank you very much. Alright. Awesome. As you probably heard as well, it was, like, the format response was Ut something wild. So you might wanna change this prompt to... Or... Yeah. Maybe change this prompt to put another chat Prompt before the response. Just to make the response a little bit more human friendly and just set what kind of what the what kind of format you want. As you saw, we just kind of fit in this response, which was, yeah. This Ut time, which is obviously very ugly. We don't want that. But you see now that it works the result of here was longer. Okay. I don't I don't I mean, I can't tell high level in the public math if we would have breached the tokens before, but we have the accept message. So we took the accept route, and then we generated the appointment here and you could see we have the appointment generated for one hour slot three to four Pm, and my phone numbers here, and that's just the placeholder for... I don't know whatever you wanna use. While we're here, let me just make sure if I just remove all this, and I saved configuration. I'm pretty sure this is just for, incoming calls. Url is not valid. Okay. Let me just leave this and just change something here. So it's not gonna point at all to our, caller. And let me trigger an outbound call. Just to confirm if we need that or not. Hi, Bart. Okay. Looks like we don't need that specific one. So I was correct before. This is only if you wanna have your inbound caller. So you don't need to set this up. Actually, everything is configured from this make dot com module and already works in the code. So, yeah, at a high level, we went through all the code, we learned how had a deploy. We learned how to do the Twilio setting, which was not really much for its Twilio side, but we had to do some stuff for the account Si account token and Twilio number, but to put our Api key into hear from Open Ai. This is just from a previous code. We can just delete this. And yeah, we spoke about the two web hooks. If I scroll down, we spoke about us passing the values, two values from make dot com into our phone call. So we have the caller number. And then the first message, which is the dynamic prompt that we're sending in that contains the customer information, whatever you wanna offer him, the, you know, the appointment setting, the appointment slot. We spoke about the end call function that maybe you might just need, you know, sharpen it up a little bit in case doesn't work right now fully. But the raw code is there, and it does... It might just be one degree from working. I kinda keep editing these codes all the time. So whatever you see on a video would be, you know, one of the versions that I have I just kinda wanna get this stuff out to give you guys as much as possible. So if it is a little bit wrong, sorry about that. Just yeah, I use Ai. And that's pretty much everything. There's nothing else left for us to do. You should watch the previous videos. If you wanna figure out how to use something like this as well. I explained function calling. I explained make dot com. I explained how to make inbound calls, and I how to feed in, like, get a pre call web hook to feed in the customer information, so you can greet the customer as they're calling with their name. And see if they wanna speak about a previous request. So you can really do a lot with make dot com as the back end. But I hope this was insightful to you guys. And if you do wanna have... Like, do you do wanna hand building this out if you're a business, if you wanna have your own local code, yeah, my email and description of this video, if you want this exact code for free, make dot com scenarios, everything for free, so you can get started as well, it's in the gum road. Alright. Thank you very much, guys and have fun with your outbound appointment center. Alright. See you. And